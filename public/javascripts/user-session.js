// Generated by CoffeeScript 1.7.1
var UserSession;

UserSession = (function() {
  function UserSession() {
    this.init();
  }

  UserSession.prototype.init = function() {
    this._findElements();
    this._attachFormValidation();
    return $(".js-login").fancybox({
      maxWidth: 400,
      maxHeight: 300,
      fitToView: false,
      width: '70%',
      height: '110px',
      autoSize: false,
      closeClick: false,
      openEffect: 'none',
      closeEffect: 'none'
    });
  };

  UserSession.prototype._findElements = function() {
    return this._$loginForm = $('form#login-form');
  };

  UserSession.prototype._attachFormValidation = function() {
    return this._$loginForm.validate({
      rules: {
        email: {
          required: true,
          email: true
        },
        password: {
          required: true
        }
      },
      highlight: function(label) {
        return $(label).closest('.row').addClass('error').find('.js-error-placement').hide();
      },
      unhighlight: function(label) {
        return $(label).closest('.row').removeClass('error').find('.js-error-placement').hide();
      },
      errorPlacement: function(error, element) {
        return $(element).closest('.row').find('.js-error-placement').show().attr('title', $(error).text());
      },
      submitHandler: (function(_this) {
        return function() {
          return helpers.ajax.post({
            url: 'session/login',
            data: _this._$loginForm.serialize(),
            targetEl: _this._$loginForm,
            cbSuccess: function(response) {
              console.log(response, response.success);
              if (response.success) {
                return location.reload();
              } else {
                return alert(response.messages.error);
              }
            }
          });
        };
      })(this)
    });
  };

  return UserSession;

})();

$(document).ready(function() {
  return new UserSession;
});
